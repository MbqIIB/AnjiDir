<?xml version="1.0" encoding="UTF-8"?><mappingRoot domainID="com.ibm.msl.mapping.xml" domainIDExtension="mb" mainMap="true" targetNamespace="default" version="8.0.4.0" xmlns="http://www.ibm.com/2008/ccl/Mapping" xmlns:map="default">
    <input path="/EXAT.xsd" var="var"/>
    <output path="db:table(/mssql.dbm,DESK,dbo,EXAT)" var="EXAT"/>
    <output path="db:table(/mssql.dbm,DESK,dbo,CARD_TRANSACTIONS)" var="CARDTRANSACTIONS"/>
    <namespaces>
        <namespace kind="extension" prefix="fn" uri="http://www.w3.org/2005/xpath-functions"/>
        <namespace kind="extension" prefix="xs" uri="http://www.w3.org/2001/XMLSchema"/>
    </namespaces>
    <generation engine="xquery"/>
    <mappingDeclaration name="EXAT">
        <input namespace="http://www.quantiguous.com/dfdl/vplus/EXATFormat" path="$var/mb:msg(EXAT,assembly,DFDL,Properties)" var="MessageAssembly"/>
        <output path="$EXAT/db:insert(fn:false(),ID,ORG,ACCOUNT,REC_NO,LOGO,TYPE,TXN_DATE,MT_TYPE,TXN_CODE,AMOUNT,F1,UNIT_PRICE,F2,BATCH_DT,POST_DATE,QUANTITY,AUTHCODE,MT_SI_ORG,MT_SI_NBR,PLAN_NO,SALESPERSO,TKT_NBR,PURCH_NUM,PMT_REF_NO,ITEM_NBR,REF_NBR,MERCHANT,CITY,COUNTRY,PLAN_OPEN,INPUT_SRC,MULT_REF,FSP,FSP_PRG_NO,MERCH_ORG,MERCH_STOR,CAT_CODE,PROD_GRP,SKU_NBR,LOGIC_MOD,RPT_DESC,GL_SOURCE,DEPT,SOURCE,BATCH_NO,BATCH_SEQ,PLAN_SEQ,SORT_PRIOR,POST_FLAG,VISATRANID,ICHNG_FEE,QUAL_ID,CARD_NBR,CARD_SEQ,CARD_BLK,INS_PROD,ACT_TERM,FOREX_CD,RELPMT_AMT,F3,ORIG_PYMT,F4,STMT_FLAG,SOU_TXN_DT,C_CITY,C_COUNTRY,SOU_TXN_AM,CURRY_CODE,C_ARN,C_AQR_BIN,C_RECORD_TYPE,CREATED_AT,UPDATED_AT)" var="dbinsert"/>
        <foreach>
            <input path="$MessageAssembly/EXAT/body" var="body"/>
            <output path="$dbinsert/." var="dbinsert1"/>
            <output path="$CARDTRANSACTIONS/db:update(fn:false(),fn:true(),db:where(&quot;ACCOUNT = ?1 AND AUTHCODE = ?2 AND TXN_DATE = ?3 AND AMOUNT  =  ?4 AND  ?5 = 'C'&quot;,'?1'=$body/ACCOUNT,'?2'=$body/AUTHCODE,'?3'=$body/TXN_DATE,'?4'=$body/AMOUNT,'?5'=$body/MT_TYPE,'?'=$body/TXN_CODE),ID,ORG,ACCOUNT,LOGO,TXN_TYPE,TXN_DATE,TXN_CODE,AMOUNT,AUTHCODE,MT_SI_ORG,MT_SI_NBR,PLAN_NO,REF_NBR,MERCHANT,CITY,RPT_DESC,CARD_NBR,CREATED_AT,UPDATED_AT,LOAN_STATUS)" var="dbupdate"/>
            <insert ref="dbinsert">
                <input path="$body/."/>
                <output path="$dbinsert1/."/>
                <move>
                    <input path="ORG" var="ORG"/>
                    <output path="ORG"/>
                </move>
                <move>
                    <input path="LOGO" var="LOGO"/>
                    <output path="LOGO"/>
                </move>
                <move>
                    <input path="ACCOUNT" var="ACCOUNT"/>
                    <output path="ACCOUNT"/>
                </move>
                <move>
                    <input path="PLAN"/>
                    <output path="PLAN_NO"/>
                </move>
                <move>
                    <input path="REF_NBR"/>
                    <output path="REF_NBR"/>
                </move>
                <move>
                    <input path="TYPE"/>
                    <output path="TYPE"/>
                </move>
                <move>
                    <input path="MT_SI_ORG"/>
                    <output path="MT_SI_ORG"/>
                </move>
                <move>
                    <input path="MT_SI_NBR"/>
                    <output path="MT_SI_NBR"/>
                </move>
                <move>
                    <input path="AMOUNT"/>
                    <output path="AMOUNT"/>
                </move>
                <move>
                    <input path="MERCHANT"/>
                    <output path="MERCHANT"/>
                </move>
                <move>
                    <input path="CITY"/>
                    <output path="CITY"/>
                </move>
                <move>
                    <input path="TXN_DATE"/>
                    <output path="TXN_DATE"/>
                </move>
                <move>
                    <input path="RPT_DESC"/>
                    <output path="RPT_DESC"/>
                </move>
                <function ref="fn:current-dateTime">
                    <output path="CREATED_AT"/>
                </function>
                <function ref="fn:current-dateTime">
                    <output path="UPDATED_AT"/>
                </function>
                <move>
                    <input path="AUTHCODE"/>
                    <output path="AUTHCODE"/>
                </move>
                <move>
                    <input path="TXN_CODE"/>
                    <output path="TXN_CODE"/>
                </move>
                <move>
                    <input path="CARD_NBR"/>
                    <output path="CARD_NBR"/>
                </move>
                <move>
                    <input path="MT_TYPE"/>
                    <output path="MT_TYPE"/>
                </move>
                <move automap="true">
                    <input path="REC_NO"/>
                    <output path="REC_NO"/>
                </move>
                <move automap="true">
                    <input path="F1"/>
                    <output path="F1"/>
                </move>
                <move automap="true">
                    <input path="UNIT_PRICE"/>
                    <output path="UNIT_PRICE"/>
                </move>
                <move automap="true">
                    <input path="F2"/>
                    <output path="F2"/>
                </move>
                <move automap="true">
                    <input path="BATCH_DT"/>
                    <output path="BATCH_DT"/>
                </move>
                <move automap="true">
                    <input path="POST_DATE"/>
                    <output path="POST_DATE"/>
                </move>
                <move automap="true">
                    <input path="QUANTITY"/>
                    <output path="QUANTITY"/>
                </move>
                <move automap="true">
                    <input path="SALESPERSO"/>
                    <output path="SALESPERSO"/>
                </move>
                <move automap="true">
                    <input path="TKT_NBR"/>
                    <output path="TKT_NBR"/>
                </move>
                <move automap="true">
                    <input path="PURCH_NUM"/>
                    <output path="PURCH_NUM"/>
                </move>
                <move automap="true">
                    <input path="PMT_REF_NO"/>
                    <output path="PMT_REF_NO"/>
                </move>
                <move automap="true">
                    <input path="ITEM_NBR"/>
                    <output path="ITEM_NBR"/>
                </move>
                <move automap="true">
                    <input path="COUNTRY"/>
                    <output path="COUNTRY"/>
                </move>
                <move automap="true">
                    <input path="PLAN_OPEN"/>
                    <output path="PLAN_OPEN"/>
                </move>
                <move automap="true">
                    <input path="INPUT_SRC"/>
                    <output path="INPUT_SRC"/>
                </move>
                <move automap="true">
                    <input path="MULT_REF"/>
                    <output path="MULT_REF"/>
                </move>
                <move automap="true">
                    <input path="FSP"/>
                    <output path="FSP"/>
                </move>
                <move automap="true">
                    <input path="FSP_PRG_NO"/>
                    <output path="FSP_PRG_NO"/>
                </move>
                <move automap="true">
                    <input path="MERCH_ORG"/>
                    <output path="MERCH_ORG"/>
                </move>
                <move automap="true">
                    <input path="MERCH_STOR"/>
                    <output path="MERCH_STOR"/>
                </move>
                <move automap="true">
                    <input path="CAT_CODE"/>
                    <output path="CAT_CODE"/>
                </move>
                <move automap="true">
                    <input path="PROD_GRP"/>
                    <output path="PROD_GRP"/>
                </move>
                <move automap="true">
                    <input path="SKU_NBR"/>
                    <output path="SKU_NBR"/>
                </move>
                <move automap="true">
                    <input path="LOGIC_MOD"/>
                    <output path="LOGIC_MOD"/>
                </move>
                <move automap="true">
                    <input path="GL_SOURCE"/>
                    <output path="GL_SOURCE"/>
                </move>
                <move automap="true">
                    <input path="DEPT"/>
                    <output path="DEPT"/>
                </move>
                <move automap="true">
                    <input path="SOURCE"/>
                    <output path="SOURCE"/>
                </move>
                <move automap="true">
                    <input path="BATCH_NO"/>
                    <output path="BATCH_NO"/>
                </move>
                <move automap="true">
                    <input path="BATCH_SEQ"/>
                    <output path="BATCH_SEQ"/>
                </move>
                <move automap="true">
                    <input path="PLAN_SEQ"/>
                    <output path="PLAN_SEQ"/>
                </move>
                <move automap="true">
                    <input path="SORT_PRIOR"/>
                    <output path="SORT_PRIOR"/>
                </move>
                <move automap="true">
                    <input path="POST_FLAG"/>
                    <output path="POST_FLAG"/>
                </move>
                <move automap="true">
                    <input path="VISATRANID"/>
                    <output path="VISATRANID"/>
                </move>
                <move automap="true">
                    <input path="ICHNG_FEE"/>
                    <output path="ICHNG_FEE"/>
                </move>
                <move automap="true">
                    <input path="QUAL_ID"/>
                    <output path="QUAL_ID"/>
                </move>
                <move automap="true">
                    <input path="CARD_SEQ"/>
                    <output path="CARD_SEQ"/>
                </move>
                <move automap="true">
                    <input path="CARD_BLK"/>
                    <output path="CARD_BLK"/>
                </move>
                <move automap="true">
                    <input path="INS_PROD"/>
                    <output path="INS_PROD"/>
                </move>
                <move automap="true">
                    <input path="ACT_TERM"/>
                    <output path="ACT_TERM"/>
                </move>
                <move automap="true">
                    <input path="FOREX_CD"/>
                    <output path="FOREX_CD"/>
                </move>
                <move automap="true">
                    <input path="RELPMT_AMT"/>
                    <output path="RELPMT_AMT"/>
                </move>
                <move automap="true">
                    <input path="F3"/>
                    <output path="F3"/>
                </move>
                <move automap="true">
                    <input path="ORIG_PYMT"/>
                    <output path="ORIG_PYMT"/>
                </move>
                <move automap="true">
                    <input path="F4"/>
                    <output path="F4"/>
                </move>
                <move automap="true">
                    <input path="STMT_FLAG"/>
                    <output path="STMT_FLAG"/>
                </move>
                <move automap="true">
                    <input path="SOU_TXN_DT"/>
                    <output path="SOU_TXN_DT"/>
                </move>
                <move automap="true">
                    <input path="C_CITY"/>
                    <output path="C_CITY"/>
                </move>
                <move automap="true">
                    <input path="C_COUNTRY"/>
                    <output path="C_COUNTRY"/>
                </move>
                <move automap="true">
                    <input path="SOU_TXN_AM"/>
                    <output path="SOU_TXN_AM"/>
                </move>
                <move automap="true">
                    <input path="CURRY_CODE"/>
                    <output path="CURRY_CODE"/>
                </move>
                <move automap="true">
                    <input path="C_ARN"/>
                    <output path="C_ARN"/>
                </move>
                <move automap="true">
                    <input path="C_RECORD_TYPE"/>
                    <output path="C_RECORD_TYPE"/>
                </move>
            </insert>
            <update ref="dbupdate">
                <input path="$body/." var="body2"/>
                <output path="$dbupdate/."/>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/ORG"/>
                    <output path="ORG"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/ACCOUNT"/>
                    <output path="ACCOUNT"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/LOGO"/>
                    <output path="LOGO"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/TYPE"/>
                    <output path="TXN_TYPE"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/TXN_DATE"/>
                    <output path="TXN_DATE"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/AMOUNT"/>
                    <output path="AMOUNT"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/AUTHCODE"/>
                    <output path="AUTHCODE"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/MT_SI_ORG"/>
                    <output path="MT_SI_ORG"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/MT_SI_NBR"/>
                    <output path="MT_SI_NBR"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/PLAN"/>
                    <output path="PLAN_NO"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/MERCHANT"/>
                    <output path="MERCHANT"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/CITY"/>
                    <output path="CITY"/>
                </move>
                <function ref="fn:current-dateTime">
                    <output path="CREATED_AT"/>
                </function>
                <function ref="fn:current-dateTime">
                    <output path="UPDATED_AT"/>
                </function>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/TXN_CODE"/>
                    <output path="TXN_CODE"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/CARD_NBR"/>
                    <output path="CARD_NBR"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/REF_NBR"/>
                    <output path="REF_NBR"/>
                </move>
                <move>
                    <input path="$var/Message Assembly/EXAT/body[1]/RPT_DESC"/>
                    <output path="RPT_DESC"/>
                </move>
            </update>
        </foreach>
    </mappingDeclaration>
</mappingRoot>