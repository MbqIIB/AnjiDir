<?xml version="1.0" encoding="UTF-8"?><mappingRoot domainID="com.ibm.msl.mapping.xml" domainIDExtension="mb" mainMap="true" targetNamespace="default" version="8.0.4.0" xmlns="http://www.ibm.com/2008/ccl/Mapping" xmlns:map="default">
    <input path="db:database(/mssql.dbm,DESK,db:schema-tables(dbo,CARD_TRANSACTIONS,CARD_LOANS,EMI_PLANS))" var="DESK"/>
    <input path="db:database(/mssql.dbm,DESK,db:schema-tables(dbo,CARD_LOAN_DETAILS))" var="DESK1"/>
    <output path="/ALSI.xsd"/>
    <namespaces>
        <namespace kind="supplement" prefix="outk" uri="http://www.quantiguous.com/dfdl/vplus/ALSIFormat"/>
        <namespace kind="extension" prefix="fn" uri="http://www.w3.org/2005/xpath-functions"/>
    </namespaces>
    <generation engine="xquery"/>
    <mappingDeclaration name="ALSI">
        <input path="$DESK/db:select(fn:false(),ResultSet(dbo/CARD_TRANSACTIONS/ID,dbo/CARD_TRANSACTIONS/ORG,dbo/CARD_TRANSACTIONS/ACCOUNT,dbo/CARD_TRANSACTIONS/LOGO,dbo/CARD_TRANSACTIONS/TXN_TYPE,dbo/CARD_TRANSACTIONS/TXN_DATE,dbo/CARD_TRANSACTIONS/TXN_CODE,dbo/CARD_TRANSACTIONS/AMOUNT,dbo/CARD_TRANSACTIONS/AUTHCODE,dbo/CARD_TRANSACTIONS/MT_SI_ORG,dbo/CARD_TRANSACTIONS/MT_SI_NBR,dbo/CARD_TRANSACTIONS/PLAN_NO,dbo/CARD_TRANSACTIONS/REF_NBR,dbo/CARD_TRANSACTIONS/MERCHANT,dbo/CARD_TRANSACTIONS/CITY,dbo/CARD_TRANSACTIONS/RPT_DESC,dbo/CARD_TRANSACTIONS/CARD_NBR,dbo/CARD_TRANSACTIONS/CREATED_AT,dbo/CARD_TRANSACTIONS/UPDATED_AT,dbo/CARD_TRANSACTIONS/LOAN_STATUS,dbo/CARD_LOANS/ID,dbo/CARD_LOANS/CREDITCARD_NO,dbo/CARD_LOANS/ACCOUNT_NO,dbo/CARD_LOANS/TRANSACTION_ID,dbo/CARD_LOANS/STATE,dbo/CARD_LOANS/ORG,dbo/CARD_LOANS/LOGO,dbo/CARD_LOANS/PLAN_ID,dbo/CARD_LOANS/TRANSACTION_REF_NO,dbo/CARD_LOANS/TRANSACTION_TYPE,dbo/CARD_LOANS/FIRST_INSTALLMENT_DATE,dbo/CARD_LOANS/LAST_INSTALLMENT_DATE,dbo/CARD_LOANS/TERM,dbo/CARD_LOANS/RATE,dbo/CARD_LOANS/EMI_AMOUNT,dbo/CARD_LOANS/PRINCIPAL_AMOUNT,dbo/CARD_LOANS/INTEREST_AMOUNT,dbo/CARD_LOANS/PROCESSING_FEE,dbo/CARD_LOANS/CREATED_BY,dbo/CARD_LOANS/UPDATED_BY,dbo/CARD_LOANS/CREATED_AT,dbo/CARD_LOANS/UPDATED_AT,dbo/EMI_PLANS/ID,dbo/EMI_PLANS/PLAN_ID,dbo/EMI_PLANS/PLAN_NAME,dbo/EMI_PLANS/TENURE,dbo/EMI_PLANS/INT_RATE,dbo/EMI_PLANS/ANNUAL_MONTHLY_FLAG,dbo/EMI_PLANS/PLAN_START_DATE,dbo/EMI_PLANS/PLAN_EXPIRY,dbo/EMI_PLANS/MIN_AMT,dbo/EMI_PLANS/MAX_AMT,dbo/EMI_PLANS/DELINQUENCY_FLAG,dbo/EMI_PLANS/PROC_FEE_FLG,dbo/EMI_PLANS/PROC_FEE_PCT,dbo/EMI_PLANS/PROC_FEE_AMT,dbo/EMI_PLANS/CREATED_BY,dbo/EMI_PLANS/UPDATED_BY,dbo/EMI_PLANS/CREATED_AT,dbo/EMI_PLANS/UPDATED_AT),db:where('dbo.CARD_TRANSACTIONS.ID = dbo.CARD_LOANS.TRANSACTION_ID AND dbo.EMI_PLANS.ID = dbo.CARD_LOANS.PLAN_ID'))" var="dbselect"/>
        <output namespace="http://www.quantiguous.com/dfdl/vplus/ALSIFormat" path="mb:msg(ALSI,assembly,DFDL,Properties)" var="MessageAssembly"/>
        <select ref="dbselect">
            <input path="$dbselect/ResultSet"/>
            <output path="$MessageAssembly/ALSI/body"/>
            <foreach>
                <input path="." var="ResultSet"/>
                <input path="$DESK1/db:select(fn:false(),ResultSet(dbo/CARD_LOAN_DETAILS/ID,dbo/CARD_LOAN_DETAILS/ACCOUNT_NO,dbo/CARD_LOAN_DETAILS/CARD_LOAN_ID,dbo/CARD_LOAN_DETAILS/INSTALLMENT,dbo/CARD_LOAN_DETAILS/INSTALLMENT_DATE,dbo/CARD_LOAN_DETAILS/RATE,dbo/CARD_LOAN_DETAILS/EMI_AMOUNT,dbo/CARD_LOAN_DETAILS/PRINCIPAL_AMOUNT,dbo/CARD_LOAN_DETAILS/INTEREST_AMOUNT,dbo/CARD_LOAN_DETAILS/PRINCIPAL_BALANCE,dbo/CARD_LOAN_DETAILS/CREATED_BY,dbo/CARD_LOAN_DETAILS/UPDATED_BY,dbo/CARD_LOAN_DETAILS/CREATED_AT,dbo/CARD_LOAN_DETAILS/UPDATED_AT),db:where('dbo.CARD_LOAN_DETAILS.ACCOUNT_NO =  ? ','?'=$ResultSet/dbo/CARD_TRANSACTIONS/ACCOUNT))" var="dbselect1"/>
                <output path="."/>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/ACCOUNT"/>
                    <output path="ABNLSI-ACCT-NBR"/>
                </move>
                <select ref="dbselect1">
                    <input path="$dbselect1/ResultSet" var="ResultSet1"/>
                    <output path="INSTALLMENTS"/>
                    <foreach>
                        <input path="$ResultSet1/." var="ResultSet3"/>
                        <output path="."/>
                        <expression>
                            <input path="$ResultSet3/dbo/CARD_LOAN_DETAILS/EMI_AMOUNT" var="EMIAMOUNT"/>
                            <output path="ABNLSI-LS-PAY-AMT"/>
                            <code lang="xpath">$EMIAMOUNT * 100</code>
                        </expression>
                        <move>
                            <input path="$ResultSet3/dbo/CARD_LOAN_DETAILS/PRINCIPAL_AMOUNT"/>
                            <output path="ABNLSI-LS-PRIN-AMT"/>
                        </move>
                        <move>
                            <input path="$ResultSet3/dbo/CARD_LOAN_DETAILS/INTEREST_AMOUNT"/>
                            <output path="ABNLSI-LS-INT-AMT"/>
                        </move>
                        <expression>
                            <input path="$ResultSet3/dbo/CARD_LOAN_DETAILS/RATE" var="RATE"/>
                            <output path="ABNLSI-LS-INT-RATE"/>
                            <code lang="xpath">$RATE * 1000</code>
                        </expression>
                    </foreach>
                </select>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/LOGO"/>
                    <output path="ABNLSI-LOGO"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/ORG"/>
                    <output path="ABNLSI-ORG"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/MT_SI_ORG"/>
                    <output path="ABNLSI-SI-ORG"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/MT_SI_NBR"/>
                    <output path="ABNLSI-SI-NBR"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/EMI_PLANS/PLAN_NAME"/>
                    <output path="ABNLSI-PLAN-DESC"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/EMI_PLANS/PLAN_ID"/>
                    <output path="ABNLSI-PLAN"/>
                </move>
                <function ref="fn:current-date">
                    <output path="ABNLSI-PLAN-DATE"/>
                </function>
                <function ref="fn:current-date">
                    <output path="ABNLSI-CEL-AGRMNT-DATE"/>
                </function>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/REF_NBR"/>
                    <output path="ABNLSI-REF-NBR"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/TXN_TYPE"/>
                    <output path="ABNLSI-REC-TYPE"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/FIRST_INSTALLMENT_DATE"/>
                    <output path="ABNLSI-CEL-1ST-PMT-DATE"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/LAST_INSTALLMENT_DATE"/>
                    <output path="ABNLSI-CEL-FINAL-PMT-DATE"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/EMI_AMOUNT"/>
                    <output path="ABNLSI-CEL-1ST-PMT"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/EMI_AMOUNT"/>
                    <output path="ABNLSI-CEL-FINAL-PMT"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/EMI_PLANS/TENURE"/>
                    <output path="ABNLSI-CEL-ORIG-TERM"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/RATE"/>
                    <output path="ABNLSI-CEL-INT-APR"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_TRANSACTIONS/AMOUNT"/>
                    <output path="ABNLSI-CEL-ORIG-DSCLSD-PRIN"/>
                </move>
                <move>
                    <input path="$ResultSet/dbo/CARD_LOANS/INTEREST_AMOUNT"/>
                    <output path="ABNLSI-CEL-ORIG-DSCLSD-INT"/>
                </move>
            </foreach>
        </select>
        <function ref="fn:count">
            <input path="$dbselect/ResultSet" var="ResultSet2"/>
            <output path="$MessageAssembly/ALSI/header/ABNLSI-H-T-FILE-COUNT"/>
            <param name="item" value="$ResultSet2"/>
        </function>
        <function ref="fn:count">
            <input path="$dbselect/ResultSet" var="ResultSet4"/>
            <output path="$MessageAssembly/ALSI/trailer/ABNLSI-H-T-FILE-COUNT"/>
            <param name="item" value="$ResultSet4"/>
        </function>
        <function ref="fn:current-date">
            <output path="$MessageAssembly/ALSI/header/ABNLSI-H-T-PROC-DATE"/>
        </function>
        <function ref="fn:current-date">
            <output path="$MessageAssembly/ALSI/trailer/ABNLSI-H-T-PROC-DATE"/>
        </function>
    </mappingDeclaration>
</mappingRoot>